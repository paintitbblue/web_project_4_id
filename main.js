!function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function o(t){var o=function(t,o){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===e(o)?o:String(o)}var r=function(){function e(t){var r,n,i,s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=this,i=function(e){"Escape"===e.key&&document.querySelector(".popup-overlay").classList.contains("popup-overlay_active")&&s.popupClose()},(n=o(n="closeAllPopup"))in r?Object.defineProperty(r,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[n]=i,this._element=t,this.setEventListeners(),this.popupOpen=this.popupOpen.bind(this),this.popupClose=this.popupClose.bind(this),this.closeAllPopup=this.closeAllPopup.bind(this)}var r,n;return r=e,(n=[{key:"setEventListeners",value:function(){this._element.querySelector(".element__image").addEventListener("click",this.popupOpen),document.querySelector(".popup-close-btn").addEventListener("click",this.popupClose),document.querySelector(".popup-overlay").addEventListener("click",this.popupClose),document.addEventListener("keyup",this.closeAllPopup)}},{key:"popupOpen",value:function(){var e=this.parentElement.querySelector(".element__image").src,t=this.parentElement.querySelector(".element__caption").textContent;document.querySelector(".popup-image").src=e,document.querySelector(".popup-title").textContent=t,document.querySelector(".popup-overlay").classList.add("popup-overlay_active"),document.addEventListener("keyup",this.closeAllPopup)}},{key:"popupClose",value:function(){document.querySelector(".popup-overlay").classList.remove("popup-overlay_active"),document.removeEventListener("keyup",this.closeAllPopup)}},{key:"closeAnywhere",value:function(e){e.target===this.editFormOverlay&&this.closeEditForm(),e.target===this.addFormOverlay&&this.closeAddCardForm(),e.target===this.popupOverlay&&this.closePopupImage()}}])&&t(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),e}();function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!==n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===n(i)?i:String(i)),r)}var i}var s=function(){function e(t,o,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._caption=t,this._image=o,this._idx=r,this._onDelete=n,this._deleteCard=this._deleteCard.bind(this)}var t,o;return t=e,(o=[{key:"_getTemplate",value:function(){return document.querySelector("#element").content.querySelector(".element").cloneNode(!0)}},{key:"generateCard",value:function(){return this._element=this._getTemplate(),this._element.querySelector(".element__image").src=this._image,this._element.querySelector(".element__caption").textContent=this._caption,this._setEventListeners(),new r(this._element),this._element}},{key:"_setEventListeners",value:function(){this._element.querySelector(".element__delete").addEventListener("click",this._deleteCard),this._element.querySelector(".element__like").addEventListener("click",this._likeCard)}},{key:"_deleteCard",value:function(e){this._onDelete(this._idx)}},{key:"_likeCard",value:function(e){this.classList.toggle("element__like-active")}}])&&i(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,n=function(e,t){if("object"!==l(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!==l(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===l(n)?n:String(n)),r)}var n}var u=function(){function e(t,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.formElement=t,this.selectors=o,this.inputList=Array.from(t.querySelectorAll("input")),this.buttonElement=t.querySelector(".form__submit-btn")}var t,o;return t=e,(o=[{key:"showInputError",value:function(e,t){var o=this.formElement.querySelector(".".concat(e.id,"-error"));e.classList.add("form__input_type_error"),o.textContent=t,o.classList.add("form__input-error")}},{key:"hideInputError",value:function(e){var t=this.formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove("form__input_type_error"),t.classList.remove("form__input-error"),t.textContent=""}},{key:"checkInputValidity",value:function(e){e.validity.valid?this.hideInputError(e):this.showInputError(e,e.validationMessage)}},{key:"hasInvalidInput",value:function(){return this.inputList.some((function(e){return!e.validity.valid}))}},{key:"toggleButtonState",value:function(){this.hasInvalidInput()?(this.buttonElement.classList.add("form__submit-btn-inactive"),this.buttonElement.disabled=!0):(this.buttonElement.classList.remove("form__submit-btn-inactive"),this.buttonElement.disabled=!1)}},{key:"setEventListeners",value:function(){var e=this;this.toggleButtonState(),this.inputList.forEach((function(t){t.addEventListener("input",(function(){e.checkInputValidity(t),e.toggleButtonState()}))}))}},{key:"enableValidation",value:function(){this.formElement.addEventListener("submit",(function(e){e.preventDefault()})),this.setEventListeners()}}])&&a(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),e}(),c=document.querySelector(".form");function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function m(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,p(r.key),r)}}function p(e){var t=function(e,t){if("object"!==d(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!==d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===d(t)?t:String(t)}function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,n=function(e,t){if("object"!==y(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!==y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===y(n)?n:String(n)),r)}var n}function v(e,t,o){return t&&f(e.prototype,t),o&&f(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}new u(document.querySelector(".add-form")).enableValidation(),new u(c).enableValidation();var b=new(function(){function e(t,o){var r,n,i,s=this,l=t.items,a=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=this,i=function(e){s._renderedItems.splice(e,1),s.renderItems()},(n=p(n="_deleteCard"))in r?Object.defineProperty(r,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[n]=i,this._renderedItems=l,this._renderer=a,this._container=document.querySelector(o)}var t,o;return t=e,(o=[{key:"addItem",value:function(e){this._renderedItems.unshift(e),this.renderItems()}},{key:"clear",value:function(){this._container.innerHTML=""}},{key:"renderItems",value:function(){this._renderer(this._container,this._renderedItems)}}])&&m(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),e}())({items:[{name:"Yosemite Valley",link:"https://practicum-content.s3.us-west-1.amazonaws.com/web-code/moved_yosemite.jpg"},{name:"Louise Lake",link:"https://practicum-content.s3.us-west-1.amazonaws.com/web-code/moved_lake-louise.jpg"},{name:"Bald Mountain",link:"https://practicum-content.s3.us-west-1.amazonaws.com/web-code/moved_bald-mountains.jpg"},{name:"Latemar",link:"https://practicum-content.s3.us-west-1.amazonaws.com/web-code/moved_latemar.jpg"},{name:"Vanoise National Park",link:"https://practicum-content.s3.us-west-1.amazonaws.com/web-code/moved_vanoise.jpg"},{name:"Lago di Braies",link:"https://practicum-content.s3.us-west-1.amazonaws.com/web-code/moved_lago.jpg"}],renderer:function(e,t){var o=this,r=[];e.innerHTML="",t.forEach((function(t,n){var i=new s(t.name,t.link,n,o._deleteCard).generateCard();r.push(i),e.append(i)}))}},".elements");b.renderItems();var _=function(){function e(){h(this,e),this.openEditFormBtn=document.querySelector(".profile__edit-btn"),this.closeEditFormBtn=document.querySelector(".profile__edit-close-btn"),this.submitEditFormBtn=document.querySelector(".profile__edit-form"),this.editForm=document.querySelector(".profile__edit-form"),this.editFormOverlay=document.querySelector(".profile__edit-form-overlay"),this.profileName=document.querySelector(".profile__info-name"),this.profileJob=document.querySelector(".profile__info-job"),this.inputName=this.editForm.querySelector('input[name="name"]'),this.inputJob=this.editForm.querySelector('input[name="job"]'),this.openEditForm=this.openEditForm.bind(this),this.closeEditForm=this.closeEditForm.bind(this),this.submitEditForm=this.submitEditForm.bind(this),this.closeAnywhere=this.closeAnywhere.bind(this),this.openEditFormBtn.addEventListener("click",this.openEditForm),this.closeEditFormBtn.addEventListener("click",this.closeEditForm),this.submitEditFormBtn.addEventListener("submit",this.submitEditForm)}return v(e,[{key:"openEditForm",value:function(){var e=this;this.editFormOverlay.classList.add("profile__edit-form-overlay_active"),this.inputName.value=this.profileName.textContent,this.inputJob.value=this.profileJob.textContent,document.addEventListener("keyup",this.closeAllPopup.bind(this)),this.editFormOverlay.addEventListener("click",(function(t){e.closeAnywhere(t)}))}},{key:"closeEditForm",value:function(){this.editFormOverlay.classList.remove("profile__edit-form-overlay_active"),document.removeEventListener("keyup",this.closeAllPopup)}},{key:"submitEditForm",value:function(e){var t=this;e.preventDefault(),this.profileName.textContent=this.inputName.value,this.profileJob.textContent=this.inputJob.value,this.closeEditForm(),this.editForm.addEventListener("keyup",(function(e){"Enter"===e.key&&t.submitEditForm(e)}))}},{key:"closeAllPopup",value:function(e){"Escape"===e.key&&this.editFormOverlay.classList.contains("profile__edit-form-overlay_active")&&this.closeEditForm()}},{key:"closeAnywhere",value:function(e){e.target===this.editFormOverlay&&this.closeEditForm(),e.target===this.addFormOverlay&&this.closeAddCardForm(),e.target===this.popupOverlay&&this.closePopupImage()}}]),e}(),E=function(){function e(){h(this,e),this.addCardBtn=document.querySelector(".profile__add-btn-rect"),this.addFormOverlay=document.querySelector(".form-overlay"),this.addForm=document.querySelector(".add-form"),this.closeCardBtn=document.querySelector(".form__close-btn"),this.submitCardBtn=document.querySelector(".add-form"),this.inputTitle=document.querySelector("input[name='title']"),this.inputUrl=document.querySelector("input[name='url']"),this.openAddCardForm=this.openAddCardForm.bind(this),this.closeAddCardForm=this.closeAddCardForm.bind(this),this.addNewCard=this.addNewCard.bind(this),this.closeAnywhere=this.closeAnywhere.bind(this),this.closeAllPopup=this.closeAllPopup.bind(this),this.addCardBtn.addEventListener("click",this.openAddCardForm),this.closeCardBtn.addEventListener("click",this.closeAddCardForm),this.submitCardBtn.addEventListener("submit",this.addNewCard)}return v(e,[{key:"openAddCardForm",value:function(){var e=this;this.addFormOverlay.classList.add("form-overlay_active"),document.addEventListener("keyup",this.closeAllPopup),this.addFormOverlay.addEventListener("click",(function(t){e.closeAnywhere(t)}))}},{key:"closeAddCardForm",value:function(){this.addFormOverlay.classList.remove("form-overlay_active"),document.removeEventListener("keyup",this.closeAllPopup)}},{key:"addNewCard",value:function(e){e.preventDefault();var t={name:this.inputTitle.value,link:this.inputUrl.value};b.addItem(t),this.closeAddCardForm()}},{key:"closeAllPopup",value:function(e){"Escape"===e.key&&this.addFormOverlay.classList.contains("form-overlay_active")&&this.closeAddCardForm()}},{key:"closeAnywhere",value:function(e){e.target===this.editFormOverlay&&this.closeEditForm(),e.target===this.addFormOverlay&&this.closeAddCardForm(),e.target===this.popupOverlay&&this.closePopupImage()}}]),e}();new _,new E}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V2hCLEtBQUtpQixpQkFDcEJqQixLQUFLa0IsZ0JBRUh6QixFQUFFdUIsU0FBV2hCLEtBQUttQixnQkFDcEJuQixLQUFLb0IsbUJBRUgzQixFQUFFdUIsU0FBV2hCLEtBQUtxQixjQUNwQnJCLEtBQUtzQixpQkFFVCxLQUFDZ0YsQ0FBQSxDQS9EVSxHQWtFRyxJQUFJZixFQUNKLElBQUllLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF85X2lkLy4vc3JjL21vZHVsZXMvUG9wVXAuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfOV9pZC8uL3NyYy9tb2R1bGVzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfOV9pZC8uL3NyYy9tb2R1bGVzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfOV9pZC8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF85X2lkLy4vc3JjL21vZHVsZXMvU2VjdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgUG9wdXAge1xyXG4gICAgY29uc3RydWN0b3IoZWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgICAgICB0aGlzLnBvcHVwT3BlbiA9IHRoaXMucG9wdXBPcGVuLmJpbmQodGhpcyk7XHJcbiAgICAgICAgdGhpcy5wb3B1cENsb3NlID0gdGhpcy5wb3B1cENsb3NlLmJpbmQodGhpcyk7XHJcbiAgICAgICAgdGhpcy5jbG9zZUFsbFBvcHVwID0gdGhpcy5jbG9zZUFsbFBvcHVwLmJpbmQodGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2ltYWdlXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLnBvcHVwT3Blbik7XHJcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cC1jbG9zZS1idG5cIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMucG9wdXBDbG9zZSk7XHJcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cC1vdmVybGF5XCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLnBvcHVwQ2xvc2UpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLmNsb3NlQWxsUG9wdXApXHJcbiAgICB9XHJcblxyXG4gICAgcG9wdXBPcGVuKCkge1xyXG4gICAgICAgIGNvbnN0IGxpbmsgPSB0aGlzLnBhcmVudEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19pbWFnZVwiKS5zcmM7XHJcbiAgICAgICAgY29uc3QgdGl0bGUgPSB0aGlzLnBhcmVudEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19jYXB0aW9uXCIpLnRleHRDb250ZW50O1xyXG5cclxuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwLWltYWdlXCIpLnNyYyA9IGxpbms7XHJcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cC10aXRsZVwiKS50ZXh0Q29udGVudCA9IHRpdGxlO1xyXG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXAtb3ZlcmxheVwiKS5jbGFzc0xpc3QuYWRkKFwicG9wdXAtb3ZlcmxheV9hY3RpdmVcIik7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIHRoaXMuY2xvc2VBbGxQb3B1cCk7XHJcbiAgICB9XHJcblxyXG4gICAgcG9wdXBDbG9zZSgpIHtcclxuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwLW92ZXJsYXlcIikuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwLW92ZXJsYXlfYWN0aXZlXCIpO1xyXG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLmNsb3NlQWxsUG9wdXApO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlQWxsUG9wdXAgPSAoZSkgPT4ge1xyXG4gICAgICAgIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXAtb3ZlcmxheVwiKS5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cC1vdmVybGF5X2FjdGl2ZVwiKSkge1xyXG4gICAgICAgICAgICB0aGlzLnBvcHVwQ2xvc2UoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNsb3NlQW55d2hlcmUoZSkge1xyXG4gICAgICAgIGlmIChlLnRhcmdldCA9PT0gdGhpcy5lZGl0Rm9ybU92ZXJsYXkpIHtcclxuICAgICAgICAgIHRoaXMuY2xvc2VFZGl0Rm9ybSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMuYWRkRm9ybU92ZXJsYXkpIHtcclxuICAgICAgICAgIHRoaXMuY2xvc2VBZGRDYXJkRm9ybSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMucG9wdXBPdmVybGF5KSB7XHJcbiAgICAgICAgICB0aGlzLmNsb3NlUG9wdXBJbWFnZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG59IiwiaW1wb3J0IHsgUG9wdXAgfSBmcm9tIFwiLi9Qb3BVcC5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIENhcmQge1xyXG4gICAgY29uc3RydWN0b3IgKGNhcHRpb24sIGltYWdlLCBpZHgsIG9uRGVsZXRlKSB7XHJcbiAgICAgICAgdGhpcy5fY2FwdGlvbiA9IGNhcHRpb247XHJcbiAgICAgICAgdGhpcy5faW1hZ2UgPSBpbWFnZTtcclxuICAgICAgICB0aGlzLl9pZHggPSBpZHg7XHJcbiAgICAgICAgdGhpcy5fb25EZWxldGUgPSBvbkRlbGV0ZTtcclxuICAgICAgICB0aGlzLl9kZWxldGVDYXJkID0gdGhpcy5fZGVsZXRlQ2FyZC5iaW5kKHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIF9nZXRUZW1wbGF0ZSgpIHtcclxuICAgICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50XHJcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIjZWxlbWVudFwiKVxyXG4gICAgICAgIC5jb250ZW50XHJcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudFwiKVxyXG4gICAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcblxyXG4gICAgICAgIHJldHVybiBjYXJkRWxlbWVudDtcclxuICAgIH1cclxuXHJcbiAgICBnZW5lcmF0ZUNhcmQoKSB7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2ltYWdlXCIpLnNyYyA9IHRoaXMuX2ltYWdlO1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19jYXB0aW9uXCIpLnRleHRDb250ZW50ID0gdGhpcy5fY2FwdGlvbjtcclxuICAgICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICAgIG5ldyBQb3B1cCh0aGlzLl9lbGVtZW50KVxyXG4gICAgICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fZGVsZXRlXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9kZWxldGVDYXJkKTtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fbGlrZVwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5fbGlrZUNhcmQpO1xyXG4gICAgfVxyXG5cclxuICAgIF9kZWxldGVDYXJkKGlkeCkge1xyXG4gICAgICAgIHRoaXMuX29uRGVsZXRlKHRoaXMuX2lkeClcclxuICAgIH1cclxuXHJcbiAgICBfbGlrZUNhcmQoZSkge1xyXG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LnRvZ2dsZShcImVsZW1lbnRfX2xpa2UtYWN0aXZlXCIpXHJcbiAgICB9XHJcbn1cclxuIiwiZXhwb3J0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xyXG4gICAgY29uc3RydWN0b3IoZm9ybUVsZW1lbnQsIHNlbGVjdG9ycykge1xyXG4gICAgICAgIHRoaXMuZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcclxuICAgICAgICB0aGlzLnNlbGVjdG9ycyA9IHNlbGVjdG9ycztcclxuICAgICAgICB0aGlzLmlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcImlucHV0XCIpKTtcclxuICAgICAgICB0aGlzLmJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmZvcm1fX3N1Ym1pdC1idG5cIik7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLmZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuICAgICAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImZvcm1fX2lucHV0X3R5cGVfZXJyb3JcIik7XHJcbiAgICAgICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xyXG4gICAgICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZm9ybV9faW5wdXQtZXJyb3JcIik7XHJcbiAgICB9XHJcblxyXG4gICAgaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XHJcbiAgICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJmb3JtX19pbnB1dF90eXBlX2Vycm9yXCIpO1xyXG4gICAgICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiZm9ybV9faW5wdXQtZXJyb3JcIik7XHJcbiAgICAgICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgIH1cclxuXHJcbiAgICBjaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KSB7XHJcbiAgICAgICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgICAgICAgdGhpcy5zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBoYXNJbnZhbGlkSW5wdXQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVCdXR0b25TdGF0ZSgpIHtcclxuICAgICAgICBcclxuICAgICAgICBpZih0aGlzLmhhc0ludmFsaWRJbnB1dCgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZm9ybV9fc3VibWl0LWJ0bi1pbmFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgdGhpcy5idXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImZvcm1fX3N1Ym1pdC1idG4taW5hY3RpdmVcIik7XHJcbiAgICAgICAgICAgIHRoaXMuYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICAgICAgdGhpcy5mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5mb3JtXCIpO1xyXG5jb25zdCBhZGRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5hZGQtZm9ybVwiKTtcclxuY29uc3QgYWRkRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGFkZEZvcm0pO1xyXG5hZGRGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuY29uc3QgZm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm0pO1xyXG5mb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTsiLCJpbXBvcnQgXCIuL3N0eWxlcy9pbmRleC5jc3NcIjtcclxuaW1wb3J0IHsgQ2FyZEl0ZW1zLCBDYXJkIH0gZnJvbSBcIi4vbW9kdWxlcy9DYXJkLmpzXCI7XHJcbmltcG9ydCB7IEZvcm1WYWxpZGF0b3IgfSBmcm9tIFwiLi9tb2R1bGVzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4vbW9kdWxlcy9TZWN0aW9uLmpzXCJcclxuXHJcbmNvbnN0IGluaXRpYWxDYXJkcyA9IFtcclxuICAgIHtcclxuICAgICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcclxuICAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3dlYi1jb2RlL21vdmVkX3lvc2VtaXRlLmpwZ1wiLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgbmFtZTogXCJMb3Vpc2UgTGFrZVwiLFxyXG4gICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vd2ViLWNvZGUvbW92ZWRfbGFrZS1sb3Vpc2UuanBnXCIsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBuYW1lOiBcIkJhbGQgTW91bnRhaW5cIixcclxuICAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3dlYi1jb2RlL21vdmVkX2JhbGQtbW91bnRhaW5zLmpwZ1wiLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgbmFtZTogXCJMYXRlbWFyXCIsXHJcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS93ZWItY29kZS9tb3ZlZF9sYXRlbWFyLmpwZ1wiLFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcclxuICAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3dlYi1jb2RlL21vdmVkX3Zhbm9pc2UuanBnXCIsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBuYW1lOiBcIkxhZ28gZGkgQnJhaWVzXCIsXHJcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS93ZWItY29kZS9tb3ZlZF9sYWdvLmpwZ1wiLFxyXG4gICAgfSxcclxuICBdO1xyXG5cclxuLy8gY29uc3QgY2FyZEl0ZW1zID0gbmV3IENhcmRJdGVtcyhpbml0aWFsQ2FyZHMpO1xyXG5cclxuZnVuY3Rpb24gcmVuZGVyU2VjdGlvbihlbGVtZW50LCBpdGVtcykge1xyXG4gIHZhciBjYXJkcyA9IFtdXHJcbiAgICAgICAgXHJcbiAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSBcIlwiXHJcbiAgICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbSwgaWR4KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChpdGVtLm5hbWUsIGl0ZW0ubGluaywgaWR4LCB0aGlzLl9kZWxldGVDYXJkKTtcclxuICAgICAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkLmdlbmVyYXRlQ2FyZCgpXHJcbiAgICAgICAgICAgIGNhcmRzLnB1c2goY2FyZEVsZW1lbnQpXHJcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kKGNhcmRFbGVtZW50KTtcclxuICAgICAgICB9KVxyXG59XHJcbmNvbnN0IHNlY3Rpb24gPSBuZXcgU2VjdGlvbigge2l0ZW1zOiBpbml0aWFsQ2FyZHMsIHJlbmRlcmVyOiByZW5kZXJTZWN0aW9ufSwgXCIuZWxlbWVudHNcIiApO1xyXG5zZWN0aW9uLnJlbmRlckl0ZW1zKClcclxuXHJcbmNsYXNzIFByb2ZpbGUge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5vcGVuRWRpdEZvcm1CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xyXG4gICAgdGhpcy5jbG9zZUVkaXRGb3JtQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWNsb3NlLWJ0blwiKTtcclxuICAgIHRoaXMuc3VibWl0RWRpdEZvcm1CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtZm9ybVwiKTtcclxuICAgIHRoaXMuZWRpdEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtZm9ybVwiKTtcclxuICAgIHRoaXMuZWRpdEZvcm1PdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWZvcm0tb3ZlcmxheVwiKTtcclxuICAgIHRoaXMucHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2luZm8tbmFtZVwiKTtcclxuICAgIHRoaXMucHJvZmlsZUpvYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW5mby1qb2JcIik7XHJcbiAgICB0aGlzLmlucHV0TmFtZSA9IHRoaXMuZWRpdEZvcm0ucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT1cIm5hbWVcIl0nKTtcclxuICAgIHRoaXMuaW5wdXRKb2IgPSB0aGlzLmVkaXRGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCJqb2JcIl0nKTtcclxuXHJcbiAgICB0aGlzLm9wZW5FZGl0Rm9ybSA9IHRoaXMub3BlbkVkaXRGb3JtLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmNsb3NlRWRpdEZvcm0gPSB0aGlzLmNsb3NlRWRpdEZvcm0uYmluZCh0aGlzKTtcclxuICAgIHRoaXMuc3VibWl0RWRpdEZvcm0gPSB0aGlzLnN1Ym1pdEVkaXRGb3JtLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmNsb3NlQW55d2hlcmUgPSB0aGlzLmNsb3NlQW55d2hlcmUuYmluZCh0aGlzKTtcclxuXHJcbiAgICB0aGlzLm9wZW5FZGl0Rm9ybUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5vcGVuRWRpdEZvcm0pO1xyXG4gICAgdGhpcy5jbG9zZUVkaXRGb3JtQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmNsb3NlRWRpdEZvcm0pO1xyXG4gICAgdGhpcy5zdWJtaXRFZGl0Rm9ybUJ0bi5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuc3VibWl0RWRpdEZvcm0pO1xyXG4gICAgXHJcbiAgfVxyXG5cclxuICBvcGVuRWRpdEZvcm0oKSB7XHJcbiAgICB0aGlzLmVkaXRGb3JtT3ZlcmxheS5jbGFzc0xpc3QuYWRkKFwicHJvZmlsZV9fZWRpdC1mb3JtLW92ZXJsYXlfYWN0aXZlXCIpO1xyXG4gICAgdGhpcy5pbnB1dE5hbWUudmFsdWUgPSB0aGlzLnByb2ZpbGVOYW1lLnRleHRDb250ZW50O1xyXG4gICAgdGhpcy5pbnB1dEpvYi52YWx1ZSA9IHRoaXMucHJvZmlsZUpvYi50ZXh0Q29udGVudDtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLmNsb3NlQWxsUG9wdXAuYmluZCh0aGlzKSk7XHJcbiAgICB0aGlzLmVkaXRGb3JtT3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcclxuICAgICAgdGhpcy5jbG9zZUFueXdoZXJlKGUpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjbG9zZUVkaXRGb3JtKCkge1xyXG4gICAgdGhpcy5lZGl0Rm9ybU92ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZShcInByb2ZpbGVfX2VkaXQtZm9ybS1vdmVybGF5X2FjdGl2ZVwiKTtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLmNsb3NlQWxsUG9wdXApO1xyXG4gIH1cclxuXHJcbiAgc3VibWl0RWRpdEZvcm0oZXZ0KSB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIHRoaXMucHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB0aGlzLmlucHV0TmFtZS52YWx1ZTtcclxuICAgIHRoaXMucHJvZmlsZUpvYi50ZXh0Q29udGVudCA9IHRoaXMuaW5wdXRKb2IudmFsdWU7XHJcbiAgICB0aGlzLmNsb3NlRWRpdEZvcm0oKTtcclxuICAgIFxyXG4gICAgdGhpcy5lZGl0Rm9ybS5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgKGUpID0+IHtcclxuICAgICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcclxuICAgICAgICB0aGlzLnN1Ym1pdEVkaXRGb3JtKGUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNsb3NlQWxsUG9wdXAoZSkge1xyXG4gICAgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIGlmICh0aGlzLmVkaXRGb3JtT3ZlcmxheS5jbGFzc0xpc3QuY29udGFpbnMoXCJwcm9maWxlX19lZGl0LWZvcm0tb3ZlcmxheV9hY3RpdmVcIikpIHtcclxuICAgICAgICB0aGlzLmNsb3NlRWRpdEZvcm0oKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2xvc2VBbnl3aGVyZShlKSB7XHJcbiAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMuZWRpdEZvcm1PdmVybGF5KSB7XHJcbiAgICAgIHRoaXMuY2xvc2VFZGl0Rm9ybSgpO1xyXG4gICAgfVxyXG4gICAgaWYgKGUudGFyZ2V0ID09PSB0aGlzLmFkZEZvcm1PdmVybGF5KSB7XHJcbiAgICAgIHRoaXMuY2xvc2VBZGRDYXJkRm9ybSgpO1xyXG4gICAgfVxyXG4gICAgaWYgKGUudGFyZ2V0ID09PSB0aGlzLnBvcHVwT3ZlcmxheSkge1xyXG4gICAgICB0aGlzLmNsb3NlUG9wdXBJbWFnZSgpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgQWRkQ2FyZCB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmFkZENhcmRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idG4tcmVjdFwiKTtcclxuICAgIHRoaXMuYWRkRm9ybU92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmZvcm0tb3ZlcmxheVwiKTtcclxuICAgIHRoaXMuYWRkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYWRkLWZvcm1cIik7XHJcbiAgICB0aGlzLmNsb3NlQ2FyZEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybV9fY2xvc2UtYnRuXCIpO1xyXG4gICAgdGhpcy5zdWJtaXRDYXJkQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5hZGQtZm9ybVwiKTtcclxuICAgIHRoaXMuaW5wdXRUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFtuYW1lPSd0aXRsZSddXCIpO1xyXG4gICAgdGhpcy5pbnB1dFVybCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFtuYW1lPSd1cmwnXVwiKTtcclxuXHJcbiAgICB0aGlzLm9wZW5BZGRDYXJkRm9ybSA9IHRoaXMub3BlbkFkZENhcmRGb3JtLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmNsb3NlQWRkQ2FyZEZvcm0gPSB0aGlzLmNsb3NlQWRkQ2FyZEZvcm0uYmluZCh0aGlzKTtcclxuICAgIHRoaXMuYWRkTmV3Q2FyZCA9IHRoaXMuYWRkTmV3Q2FyZC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5jbG9zZUFueXdoZXJlID0gdGhpcy5jbG9zZUFueXdoZXJlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmNsb3NlQWxsUG9wdXAgPSB0aGlzLmNsb3NlQWxsUG9wdXAuYmluZCh0aGlzKTtcclxuXHJcbiAgICB0aGlzLmFkZENhcmRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMub3BlbkFkZENhcmRGb3JtKTtcclxuICAgIHRoaXMuY2xvc2VDYXJkQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmNsb3NlQWRkQ2FyZEZvcm0pO1xyXG4gICAgdGhpcy5zdWJtaXRDYXJkQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5hZGROZXdDYXJkKTtcclxuICB9XHJcblxyXG4gIG9wZW5BZGRDYXJkRm9ybSgpIHtcclxuICAgIHRoaXMuYWRkRm9ybU92ZXJsYXkuY2xhc3NMaXN0LmFkZChcImZvcm0tb3ZlcmxheV9hY3RpdmVcIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5jbG9zZUFsbFBvcHVwKTtcclxuICAgIHRoaXMuYWRkRm9ybU92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XHJcbiAgICAgIHRoaXMuY2xvc2VBbnl3aGVyZShlKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2xvc2VBZGRDYXJkRm9ybSgpIHtcclxuICAgIHRoaXMuYWRkRm9ybU92ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZShcImZvcm0tb3ZlcmxheV9hY3RpdmVcIik7XHJcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5jbG9zZUFsbFBvcHVwKTtcclxuICB9XHJcblxyXG4gIGFkZE5ld0NhcmQoZXZ0KSB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnN0IG5ld0NhcmQgPSB7XHJcbiAgICAgIG5hbWU6IHRoaXMuaW5wdXRUaXRsZS52YWx1ZSxcclxuICAgICAgbGluazogdGhpcy5pbnB1dFVybC52YWx1ZSxcclxuICAgIH07XHJcbiAgICBzZWN0aW9uLmFkZEl0ZW0obmV3Q2FyZClcclxuICAgIFxyXG4gICAgdGhpcy5jbG9zZUFkZENhcmRGb3JtKCk7XHJcbiAgfVxyXG5cclxuICBjbG9zZUFsbFBvcHVwKGUpIHtcclxuICAgIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICBpZiAodGhpcy5hZGRGb3JtT3ZlcmxheS5jbGFzc0xpc3QuY29udGFpbnMoXCJmb3JtLW92ZXJsYXlfYWN0aXZlXCIpKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZUFkZENhcmRGb3JtKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsb3NlQW55d2hlcmUoZSkge1xyXG4gICAgaWYgKGUudGFyZ2V0ID09PSB0aGlzLmVkaXRGb3JtT3ZlcmxheSkge1xyXG4gICAgICB0aGlzLmNsb3NlRWRpdEZvcm0oKTtcclxuICAgIH1cclxuICAgIGlmIChlLnRhcmdldCA9PT0gdGhpcy5hZGRGb3JtT3ZlcmxheSkge1xyXG4gICAgICB0aGlzLmNsb3NlQWRkQ2FyZEZvcm0oKTtcclxuICAgIH1cclxuICAgIGlmIChlLnRhcmdldCA9PT0gdGhpcy5wb3B1cE92ZXJsYXkpIHtcclxuICAgICAgdGhpcy5jbG9zZVBvcHVwSW1hZ2UoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IHByb2ZpbGUgPSBuZXcgUHJvZmlsZSgpO1xyXG5jb25zdCBhZGRDYXJkID0gbmV3IEFkZENhcmQoKTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xyXG4gICAgICB0aGlzLl9yZW5kZXJlZEl0ZW1zID0gaXRlbXM7XHJcbiAgICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgX2RlbGV0ZUNhcmQgPSAoaWR4KSA9PiB7XHJcbiAgICAgIHRoaXMuX3JlbmRlcmVkSXRlbXMuc3BsaWNlKGlkeCwgMSlcclxuICAgICAgdGhpcy5yZW5kZXJJdGVtcygpXHJcbiAgICB9XHJcbiAgXHJcbiAgICBhZGRJdGVtKGVsZW1lbnQpIHtcclxuICAgICAgdGhpcy5fcmVuZGVyZWRJdGVtcy51bnNoaWZ0KGVsZW1lbnQpO1xyXG4gICAgICB0aGlzLnJlbmRlckl0ZW1zKClcclxuICAgIH1cclxuICBcclxuICAgIGNsZWFyKCkge1xyXG4gICAgICB0aGlzLl9jb250YWluZXIuaW5uZXJIVE1MID0gXCJcIjtcclxuICAgIH1cclxuICBcclxuICAgIHJlbmRlckl0ZW1zKCkge1xyXG4gICAgICB0aGlzLl9yZW5kZXJlcih0aGlzLl9jb250YWluZXIsIHRoaXMuX3JlbmRlcmVkSXRlbXMpXHJcbiAgICB9XHJcbiAgfSJdLCJuYW1lcyI6WyJQb3B1cCIsImVsZW1lbnQiLCJfdGhpcyIsIl9jbGFzc0NhbGxDaGVjayIsImUiLCJrZXkiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsInBvcHVwQ2xvc2UiLCJ0aGlzIiwiX2VsZW1lbnQiLCJzZXRFdmVudExpc3RlbmVycyIsInBvcHVwT3BlbiIsImJpbmQiLCJjbG9zZUFsbFBvcHVwIiwidmFsdWUiLCJhZGRFdmVudExpc3RlbmVyIiwibGluayIsInBhcmVudEVsZW1lbnQiLCJzcmMiLCJ0aXRsZSIsInRleHRDb250ZW50IiwiYWRkIiwicmVtb3ZlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInRhcmdldCIsImVkaXRGb3JtT3ZlcmxheSIsImNsb3NlRWRpdEZvcm0iLCJhZGRGb3JtT3ZlcmxheSIsImNsb3NlQWRkQ2FyZEZvcm0iLCJwb3B1cE92ZXJsYXkiLCJjbG9zZVBvcHVwSW1hZ2UiLCJDYXJkIiwiY2FwdGlvbiIsImltYWdlIiwiaWR4Iiwib25EZWxldGUiLCJfY2FwdGlvbiIsIl9pbWFnZSIsIl9pZHgiLCJfb25EZWxldGUiLCJfZGVsZXRlQ2FyZCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfZ2V0VGVtcGxhdGUiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJfbGlrZUNhcmQiLCJ0b2dnbGUiLCJGb3JtVmFsaWRhdG9yIiwiZm9ybUVsZW1lbnQiLCJzZWxlY3RvcnMiLCJpbnB1dExpc3QiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiYnV0dG9uRWxlbWVudCIsImlucHV0RWxlbWVudCIsImVycm9yTWVzc2FnZSIsImVycm9yRWxlbWVudCIsImNvbmNhdCIsImlkIiwidmFsaWRpdHkiLCJ2YWxpZCIsImhpZGVJbnB1dEVycm9yIiwic2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsInNvbWUiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlZCIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiZm9yRWFjaCIsImNoZWNrSW5wdXRWYWxpZGl0eSIsImV2dCIsInByZXZlbnREZWZhdWx0IiwiZm9ybSIsImVuYWJsZVZhbGlkYXRpb24iLCJzZWN0aW9uIiwiU2VjdGlvbiIsIl9yZWYiLCJjb250YWluZXJTZWxlY3RvciIsIml0ZW1zIiwicmVuZGVyZXIiLCJfcmVuZGVyZWRJdGVtcyIsInNwbGljZSIsInJlbmRlckl0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsInVuc2hpZnQiLCJpbm5lckhUTUwiLCJuYW1lIiwiY2FyZHMiLCJpdGVtIiwiY2FyZEVsZW1lbnQiLCJnZW5lcmF0ZUNhcmQiLCJwdXNoIiwiYXBwZW5kIiwiUHJvZmlsZSIsIm9wZW5FZGl0Rm9ybUJ0biIsImNsb3NlRWRpdEZvcm1CdG4iLCJzdWJtaXRFZGl0Rm9ybUJ0biIsImVkaXRGb3JtIiwicHJvZmlsZU5hbWUiLCJwcm9maWxlSm9iIiwiaW5wdXROYW1lIiwiaW5wdXRKb2IiLCJvcGVuRWRpdEZvcm0iLCJzdWJtaXRFZGl0Rm9ybSIsImNsb3NlQW55d2hlcmUiLCJfY3JlYXRlQ2xhc3MiLCJfdGhpczIiLCJfdGhpczMiLCJBZGRDYXJkIiwiYWRkQ2FyZEJ0biIsImFkZEZvcm0iLCJjbG9zZUNhcmRCdG4iLCJzdWJtaXRDYXJkQnRuIiwiaW5wdXRUaXRsZSIsImlucHV0VXJsIiwib3BlbkFkZENhcmRGb3JtIiwiYWRkTmV3Q2FyZCIsIl90aGlzNCIsIm5ld0NhcmQiLCJhZGRJdGVtIl0sInNvdXJjZVJvb3QiOiIifQ==